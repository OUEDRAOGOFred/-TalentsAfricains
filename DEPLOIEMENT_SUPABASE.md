# üöÄ Guide de D√©ploiement - TalentsAfricains avec Supabase

## Architecture de d√©ploiement
- **Frontend** : Vercel (React + Vite)
- **Backend** : Render (Node.js + Express)
- **Base de donn√©es** : Supabase (PostgreSQL) ‚≠ê RECOMMAND√â
- **Storage images** : Supabase Storage (gratuit)

---

## üéØ Pourquoi Supabase ?

| Avantage | Description |
|----------|-------------|
| **100% Gratuit** | Pas de carte bancaire requise |
| **PostgreSQL** | Plus puissant que MySQL |
| **Storage int√©gr√©** | H√©bergement gratuit des images |
| **500 MB** | Base de donn√©es |
| **1 GB** | Storage pour images |
| **API REST** | G√©n√©r√©e automatiquement |
| **Pas de sleep** | Toujours actif (contrairement √† Render free) |

---

## üì¶ √âTAPE 1 : Cr√©er un compte Supabase

### 1.1 Inscription
1. Allez sur https://supabase.com
2. Cliquez sur **"Start your project"**
3. Connectez-vous avec **GitHub** (recommand√©)
4. Acceptez les permissions

### 1.2 Cr√©er un nouveau projet
1. Cliquez sur **"New Project"**
2. Remplissez les informations :
   - **Name** : `talentsafricains`
   - **Database Password** : G√©n√©rez un mot de passe fort (NOTEZ-LE !)
   - **Region** : `Europe (Frankfurt)` ou `Europe (London)`
   - **Pricing Plan** : **Free** (0$/mois)
3. Cliquez sur **"Create new project"**
4. ‚è≥ Attendez 2-3 minutes (cr√©ation de la base de donn√©es)

---

## üìä √âTAPE 2 : Configurer la base de donn√©es

### 2.1 Acc√©der au SQL Editor
1. Dans votre projet Supabase, allez dans le menu de gauche
2. Cliquez sur **"SQL Editor"**
3. Cliquez sur **"New query"**

### 2.2 Cr√©er les tables (IMPORTANT : Adapter de MySQL √† PostgreSQL)

Copiez-collez ce script SQL dans l'√©diteur :

```sql
-- ============================================
-- TalentsAfricains - Schema PostgreSQL
-- Adapt√© depuis MySQL pour Supabase
-- ============================================

-- Table users
CREATE TABLE IF NOT EXISTS users (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    bio TEXT,
    photo_profil VARCHAR(255),
    linkedin VARCHAR(255),
    twitter VARCHAR(255),
    website VARCHAR(255),
    role VARCHAR(50) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table projects
CREATE TABLE IF NOT EXISTS projects (
    id SERIAL PRIMARY KEY,
    titre VARCHAR(200) NOT NULL,
    description TEXT NOT NULL,
    categorie VARCHAR(100) NOT NULL,
    localisation VARCHAR(150),
    image_principale VARCHAR(255),
    galerie_images TEXT,
    lien_demo VARCHAR(255),
    lien_github VARCHAR(255),
    statut VARCHAR(50) DEFAULT 'en_cours',
    user_id INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    views INTEGER DEFAULT 0,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Table likes
CREATE TABLE IF NOT EXISTS likes (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    project_id INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, project_id),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);

-- Table comments
CREATE TABLE IF NOT EXISTS comments (
    id SERIAL PRIMARY KEY,
    content TEXT NOT NULL,
    user_id INTEGER NOT NULL,
    project_id INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);

-- Index pour optimiser les performances
CREATE INDEX IF NOT EXISTS idx_projects_user_id ON projects(user_id);
CREATE INDEX IF NOT EXISTS idx_projects_categorie ON projects(categorie);
CREATE INDEX IF NOT EXISTS idx_likes_user_id ON likes(user_id);
CREATE INDEX IF NOT EXISTS idx_likes_project_id ON likes(project_id);
CREATE INDEX IF NOT EXISTS idx_comments_project_id ON comments(project_id);

-- Fonction pour mettre √† jour updated_at automatiquement
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';

-- Trigger pour users
CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- Trigger pour projects
CREATE TRIGGER update_projects_updated_at BEFORE UPDATE ON projects
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

4. Cliquez sur **"Run"** (en bas √† droite)
5. ‚úÖ Vous devriez voir "Success. No rows returned"

### 2.3 Ins√©rer des donn√©es de test (Optionnel)

```sql
-- Ins√©rer un utilisateur admin (mot de passe: Password123!)
INSERT INTO users (first_name, last_name, email, password, bio, role) VALUES
('Admin', 'TalentsAfricains', 'admin@talentsafricains.com', 
 '$2a$10$8K1p/a0dL3.DKqKbKV5Y8e5RFXM9x7nYVvJZ7QZQK5XQKJ5XQKJ5X', 
 'Administrateur de la plateforme TalentsAfricains', 'admin');

-- Ins√©rer des utilisateurs de test
INSERT INTO users (first_name, last_name, email, password, bio) VALUES
('Amina', 'Diallo', 'amina.diallo@example.com', 
 '$2a$10$8K1p/a0dL3.DKqKbKV5Y8e5RFXM9x7nYVvJZ7QZQK5XQKJ5XQKJ5X', 
 'D√©veloppeuse full-stack passionn√©e par l''innovation technologique en Afrique'),
('Kwame', 'Mensah', 'kwame.mensah@example.com', 
 '$2a$10$8K1p/a0dL3.DKqKbKV5Y8e5RFXM9x7nYVvJZ7QZQK5XQKJ5XQKJ5X', 
 'Designer UI/UX avec 5 ans d''exp√©rience');

-- Ins√©rer des projets de test
INSERT INTO projects (titre, description, categorie, localisation, statut, user_id) VALUES
('Application de E-commerce', 'Plateforme de vente en ligne pour artisans africains', 'Web', 'Dakar, S√©n√©gal', 'termine', 1),
('Syst√®me de gestion scolaire', 'Application de gestion pour √©coles primaires', 'Mobile', 'Accra, Ghana', 'en_cours', 2);
```

### 2.4 R√©cup√©rer les informations de connexion

1. Allez dans **"Settings"** (‚öôÔ∏è en bas √† gauche)
2. Cliquez sur **"Database"**
3. Sous **"Connection string"**, s√©lectionnez **"URI"**
4. Cliquez sur **"Copy"**
5. ‚úÖ Vous avez quelque chose comme :
   ```
   postgresql://postgres.xxxxx:[PASSWORD]@aws-0-eu-central-1.pooler.supabase.com:5432/postgres
   ```
6. **NOTEZ** aussi :
   - **Host** : `aws-0-eu-central-1.pooler.supabase.com`
   - **Database** : `postgres`
   - **Port** : `5432`
   - **User** : `postgres.xxxxx`
   - **Password** : Le mot de passe que vous avez cr√©√©

---

## üîß √âTAPE 3 : Adapter le Backend pour PostgreSQL

### 3.1 Installer le driver PostgreSQL

Ouvrez PowerShell dans `C:\TalentsAfricains\backend` et ex√©cutez :

```powershell
npm install pg
```

### 3.2 Modifier database.js

Le fichier `backend/src/config/database.js` doit √™tre modifi√© pour utiliser PostgreSQL au lieu de MySQL.

**Nouveau contenu** :

```javascript
/**
 * Configuration de la connexion √† la base de donn√©es PostgreSQL (Supabase)
 */

const { Pool } = require('pg');
require('dotenv').config();

// Configuration du pool de connexions PostgreSQL
const pool = new Pool({
  host: process.env.DB_HOST || 'localhost',
  port: process.env.DB_PORT || 5432,
  user: process.env.DB_USER || 'postgres',
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME || 'postgres',
  ssl: process.env.NODE_ENV === 'production' ? {
    rejectUnauthorized: false
  } : false,
  max: 10,
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 2000,
});

// Test de connexion
pool.on('connect', () => {
  console.log('‚úÖ Connexion √† PostgreSQL (Supabase) √©tablie avec succ√®s');
});

pool.on('error', (err) => {
  console.error('‚ùå Erreur PostgreSQL:', err.message);
});

// Adapter pour utiliser la m√™me interface que MySQL
const promisePool = {
  query: async (text, params) => {
    const result = await pool.query(text, params);
    return [result.rows];
  },
  execute: async (text, params) => {
    const result = await pool.query(text, params);
    return [result.rows];
  }
};

module.exports = promisePool;
```

### 3.3 Adapter les requ√™tes SQL

PostgreSQL utilise `$1, $2, $3` au lieu de `?` pour les param√®tres.

**IMPORTANT** : Je vais cr√©er un script de migration automatique pour adapter tous vos mod√®les !

---

## üñºÔ∏è √âTAPE 4 : Configurer Supabase Storage (Images)

### 4.1 Cr√©er un bucket pour les images

1. Dans Supabase, allez dans **"Storage"** (menu gauche)
2. Cliquez sur **"New bucket"**
3. Remplissez :
   - **Name** : `uploads`
   - **Public bucket** : ‚úÖ Cochez (pour acc√®s public aux images)
4. Cliquez sur **"Create bucket"**

### 4.2 Configurer les permissions

1. Cliquez sur votre bucket `uploads`
2. Allez dans **"Policies"**
3. Cliquez sur **"New policy"**
4. S√©lectionnez **"For full customization"**
5. Policy pour **INSERT** (permettre upload) :
   ```sql
   CREATE POLICY "Allow authenticated uploads"
   ON storage.objects FOR INSERT
   TO authenticated
   WITH CHECK (bucket_id = 'uploads');
   ```
6. Policy pour **SELECT** (permettre lecture publique) :
   ```sql
   CREATE POLICY "Allow public read"
   ON storage.objects FOR SELECT
   TO public
   USING (bucket_id = 'uploads');
   ```

---

## üöÄ √âTAPE 5 : D√©ployer sur Render (Backend)

### 5.1 Cr√©er un compte Render
1. Allez sur https://render.com
2. Connectez-vous avec **GitHub**

### 5.2 Cr√©er un nouveau Web Service
1. Cliquez sur **"New +"** ‚Üí **"Web Service"**
2. S√©lectionnez votre repository : `OUEDRAOGOFred/-TalentsAfricains`
3. Configuration :
   - **Name** : `talentsafricains-api`
   - **Region** : `Frankfurt (EU Central)`
   - **Branch** : `main`
   - **Root Directory** : `backend`
   - **Runtime** : `Node`
   - **Build Command** : `npm install`
   - **Start Command** : `npm start`
   - **Instance Type** : `Free`

### 5.3 Variables d'environnement

Cliquez sur **"Environment Variables"** et ajoutez :

| Key | Value | Exemple |
|-----|-------|---------|
| `NODE_ENV` | `production` | - |
| `PORT` | `10000` | - |
| `DB_HOST` | Depuis Supabase | `aws-0-eu-central-1.pooler.supabase.com` |
| `DB_PORT` | `5432` | - |
| `DB_USER` | Depuis Supabase | `postgres.xxxxx` |
| `DB_PASSWORD` | Mot de passe Supabase | `votre_mot_de_passe` |
| `DB_NAME` | `postgres` | - |
| `JWT_SECRET` | G√©n√©rez une cl√© forte | `abc123xyz789...` |
| `FRONTEND_URL` | URL Vercel (√©tape suivante) | `https://votre-app.vercel.app` |

### 5.4 D√©ployer
1. Cliquez sur **"Create Web Service"**
2. ‚è≥ Attendez 2-3 minutes
3. ‚úÖ Notez votre URL : `https://talentsafricains-api.onrender.com`

---

## üåê √âTAPE 6 : D√©ployer sur Vercel (Frontend)

### 6.1 Cr√©er un compte Vercel
1. Allez sur https://vercel.com
2. Connectez-vous avec **GitHub**

### 6.2 Importer le projet
1. Cliquez sur **"Add New..."** ‚Üí **"Project"**
2. S√©lectionnez : `OUEDRAOGOFred/-TalentsAfricains`
3. Configuration :
   - **Framework Preset** : `Vite`
   - **Root Directory** : `frontend`
   - **Build Command** : `npm run build`
   - **Output Directory** : `dist`

### 6.3 Variable d'environnement

| Name | Value |
|------|-------|
| `VITE_API_URL` | `https://talentsafricains-api.onrender.com` |

### 6.4 D√©ployer
1. Cliquez sur **"Deploy"**
2. ‚è≥ Attendez 1-2 minutes
3. ‚úÖ Votre site : `https://votre-app.vercel.app`

---

## üîÑ √âTAPE 7 : Finaliser la configuration

### 7.1 Mettre √† jour FRONTEND_URL dans Render
1. Retournez sur Render
2. Allez dans votre service ‚Üí **"Environment"**
3. Modifiez `FRONTEND_URL` avec l'URL Vercel
4. Cliquez sur **"Save Changes"**

### 7.2 Tester l'application
1. Ouvrez votre site Vercel
2. Cr√©ez un compte
3. Cr√©ez un projet
4. Testez les likes et commentaires

---

## üìä Comparaison : PlanetScale vs Supabase

| Feature | PlanetScale | Supabase | Gagnant |
|---------|-------------|----------|---------|
| **Prix** | Gratuit | Gratuit | ‚öñÔ∏è |
| **Type BDD** | MySQL | PostgreSQL | üèÜ Supabase |
| **Storage** | ‚ùå Non | ‚úÖ 1 GB gratuit | üèÜ Supabase |
| **Auth** | ‚ùå Non | ‚úÖ Int√©gr√©e | üèÜ Supabase |
| **API REST** | ‚ùå Non | ‚úÖ Auto-g√©n√©r√©e | üèÜ Supabase |
| **Sleep mode** | ‚ùå Non | ‚ùå Non | ‚öñÔ∏è |
| **Interface** | Bien | Excellente | üèÜ Supabase |

**Verdict : Supabase est MEILLEUR pour votre projet ! üéâ**

---

## üÜò D√©pannage

### Erreur de connexion PostgreSQL
```
Error: Connection terminated unexpectedly
```
**Solution** : V√©rifiez que `ssl: { rejectUnauthorized: false }` est dans database.js

### Images ne s'affichent pas
**Solution** : V√©rifiez que le bucket Supabase `uploads` est **Public**

### Requ√™tes SQL ne marchent pas
**Solution** : PostgreSQL utilise `$1, $2` et non `?` - utilisez le script de migration que je vais cr√©er

---

## üìà Limites du plan gratuit Supabase

| Ressource | Limite |
|-----------|--------|
| **Base de donn√©es** | 500 MB |
| **Storage** | 1 GB |
| **Bande passante** | 5 GB/mois |
| **API requests** | Illimit√© |
| **Utilisateurs** | Illimit√© |

**Pour 95% des projets, c'est largement suffisant ! üöÄ**

---

## üéØ Prochaines √©tapes

Une fois d√©ploy√© :
1. ‚úÖ Changez le mot de passe admin
2. ‚úÖ Configurez un nom de domaine personnalis√© (optionnel)
3. ‚úÖ Activez les analytics Vercel
4. ‚úÖ Configurez des backups Supabase

---

**D√©velopp√© par Freddy OUEDRAOGO**

üåê **Liens utiles** :
- Supabase Dashboard : https://app.supabase.com
- Render Dashboard : https://dashboard.render.com
- Vercel Dashboard : https://vercel.com/dashboard
